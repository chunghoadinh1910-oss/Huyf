--================================================--
--              VIET HUB | COMMUNITY              --
--================================================--

--==================== CONFIG ====================--
local HUB_NAME = "m·∫π m√†y b√©o | m·∫π t√¥i c√≥ h∆°i v√¥ gia c∆∞ Community" -- üîß ƒê·ªîI T√äN HUB ·ªû ƒê√ÇY

-- ===== CREDIT =====
local CREATOR_NAME = "tr√πm ƒë ƒë dis hanami ( id concak1910 )"
local CREATOR_CONTACT = "discord.gg/yourserver"

-- ===== LINK KEY (B·∫†N T·ª∞ QU·∫¢N) =====
local COMMON_KEY_LINK = "https://raw.githubusercontent.com/chunghoadinh1910-oss/Huyf/refs/heads/main/text%206.txt"
local USER_KEY_LINK   = "https://raw.githubusercontent.com/chunghoadinh1910-oss/Huyf/refs/heads/main/user%20key.txt"
local GET_KEY_LINK    = "https://notevn.com/raw/5v17w2g8"
local KEY_FILE        = "VietHub_Key.json"

-- ===== SCRIPT T·ªîNG H·ª¢P =====
local SCRIPTS = {
    -- üî• Script hot
    { Name = "Blox Fruits", Link = "LINK_SCRIPT_BLOXFRUITS" },
    { Name = "Pet Simulator X", Link = "LINK_SCRIPT_PETSIM" },
    { Name = "Arsenal", Link = "LINK_SCRIPT_ARSENAL" },
    { Name = "Anime Adventures", Link = "LINK_SCRIPT_ANIME" },

    -- üáªüá≥ C·ªông ƒë·ªìng Vi·ªát Nam
    { Name = "VN Hub", Link = "LINK_SCRIPT_VN_1" },
    { Name = "Teo Hub", Link = "LINK_SCRIPT_VN_2" },
}

--==================== SERVICES ====================--
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local Player = Players.LocalPlayer
local Today = os.date("!%Y-%m-%d")

--==================== UTILS ====================--
local function IsExpired(exp)
    return Today > exp
end

--==================== SAVE / LOAD KEY ====================--
local function SaveKey(key, exp)
    if not writefile then return end
    writefile(KEY_FILE, HttpService:JSONEncode({
        Key = key,
        Exp = exp,
        ActivatedAt = os.date("%Y-%m-%d %H:%M:%S")
    }))
end

local function LoadKey()
    if not readfile or not isfile then return end
    if not isfile(KEY_FILE) then return end
    local data = HttpService:JSONDecode(readfile(KEY_FILE))
    return data.Key, data.Exp, data.ActivatedAt
end

local function DeleteKey()
    if delfile and isfile and isfile(KEY_FILE) then
        delfile(KEY_FILE)
    end
end

--==================== CHECK KEY ====================--
local function CheckKey(inputKey)
    inputKey = inputKey:match("^%s*(.-)%s*$")

    -- KEY CHUNG
    local commonRaw = game:HttpGet(COMMON_KEY_LINK)
    for line in commonRaw:gmatch("[^\r\n]+") do
        local key, exp = line:match("(.+)|(.+)")
        if key == inputKey and not IsExpired(exp) then
            return true, exp
        end
    end

    -- KEY RI√äNG (UserId=KEY|HSD)
    local userRaw = game:HttpGet(USER_KEY_LINK)
    for line in userRaw:gmatch("[^\r\n]+") do
        local id, rest = line:match("(%d+)%=(.+)")
        if id == tostring(Player.UserId) then
            local key, exp = rest:match("(.+)|(.+)")
            if key == inputKey and not IsExpired(exp) then
                return true, exp
            end
        end
    end

    return false
end

--==================== KEY UI ====================--
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "VietHub_KeyUI"
gui.Enabled = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromScale(0.32, 0.34)
frame.Position = UDim2.fromScale(0.34, 0.33)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.Active, frame.Draggable = true, true
Instance.new("UICorner", frame)

local box = Instance.new("TextBox", frame)
box.Size = UDim2.fromScale(0.8, 0.2)
box.Position = UDim2.fromScale(0.1, 0.28)
box.PlaceholderText = "Nh·∫≠p key..."
box.BackgroundColor3 = Color3.fromRGB(45,45,45)
box.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", box)

local btn = Instance.new("TextButton", frame)
btn.Size = UDim2.fromScale(0.5, 0.18)
btn.Position = UDim2.fromScale(0.25, 0.52)
btn.Text = "CONFIRM"
btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
btn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", btn)

local changeKey = Instance.new("TextButton", frame)
changeKey.Size = UDim2.fromScale(0.5, 0.14)
changeKey.Position = UDim2.fromScale(0.25, 0.75)
changeKey.Text = "CHANGE KEY"
changeKey.BackgroundColor3 = Color3.fromRGB(110,80,80)
Instance.new("UICorner", changeKey)

changeKey.MouseButton1Click:Connect(function()
    DeleteKey()
    gui.Enabled = true
end)

--==================== HUD ====================--
local hudGui = Instance.new("ScreenGui", game.CoreGui)
hudGui.Name = "VietHub_HUD"

local hudBtn = Instance.new("ImageButton", hudGui)
hudBtn.Size = UDim2.fromOffset(45, 45)
hudBtn.Position = UDim2.fromScale(0.02, 0.5)
hudBtn.BackgroundColor3 = Color3.fromRGB(40,40,40)
hudBtn.Image = "rbxassetid://7072718366"
hudBtn.Active = true
hudBtn.Draggable = true
Instance.new("UICorner", hudBtn)

--==================== OPEN HUB ====================--
local Window
local function OpenHub()
    local Fluent = loadstring(game:HttpGet(
        "https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"
    ))()

    Window = Fluent:CreateWindow({
        Title = HUB_NAME,
        SubTitle = "Scripts t·ªïng h·ª£p",
        TabWidth = 160,
        Size = UDim2.fromOffset(540, 380),
        Theme = "Dark"
    })

    local Main = Window:AddTab({ Title = "Scripts" })
    local Info = Window:AddTab({ Title = "Key Info" })
    local Extra = Window:AddTab({ Title = "Ch·ª©c nƒÉng" })
    local Credit = Window:AddTab({ Title = "Credit" })

    local _, exp, act = LoadKey()

    Info:AddParagraph({
        Title = "üîê Th√¥ng tin key",
        Content = "K√≠ch ho·∫°t: "..(act or "N/A").."\nH·∫øt h·∫°n: "..(exp or "N/A")
    })

    for _, sc in ipairs(SCRIPTS) do
        Main:AddButton({
            Title = sc.Name,
            Callback = function()
                loadstring(game:HttpGet(sc.Link, true))()
            end
        })
    end

    Extra:AddButton({
        Title = "Test Function",
        Callback = function()
            print("Extra function running")
        end
    })

    Credit:AddParagraph({
        Title = HUB_NAME,
        Content = "Author: "..CREATOR_NAME.."\nContact: "..CREATOR_CONTACT
    })

    Window:SelectTab(1)
end

--==================== HUD TOGGLE ====================--
local minimized = false
hudBtn.MouseButton1Click:Connect(function()
    if not Window then return end
    minimized = not minimized
    if minimized then
        Window:Minimize()
    else
        Window:Restore()
    end
end)

--==================== AUTO LOGIN ====================--
task.spawn(function()
    task.wait(0.5)
    local k, exp = LoadKey()
    if k and not IsExpired(exp) and CheckKey(k) then
        gui:Destroy()
        OpenHub()
    else
        DeleteKey()
        gui.Enabled = true
    end
end)

--==================== MANUAL LOGIN ====================--
btn.MouseButton1Click:Connect(function()
    local input = box.Text
    if input == "" then return end
    local ok, exp = CheckKey(input)
    if ok then
        SaveKey(input, exp)
        gui:Destroy()
        OpenHub()
    else
        btn.Text = "‚ùå SAI KEY"
        task.wait(1)
        btn.Text = "CONFIRM"
    end
end)
